<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login – OptimizeAI</title>
  <link rel="stylesheet" href="../style.css" />
  <style>
    .login-container {
      min-height: calc(100vh - 200px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 80px 24px 60px;
    }
    .login-box {
      width: 100%;
      max-width: 440px;
      background: var(--color-bg);
      border-radius: var(--radius-xl);
      border: 1px solid var(--color-border);
      box-shadow: var(--shadow-lg);
      padding: 48px;
      position: relative;
    }
    .login-header {
      text-align: center;
      margin-bottom: 40px;
    }
    .login-header h1 {
      font-size: 32px;
      font-weight: 700;
      margin: 0 0 12px;
      background: var(--color-bg-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .login-header p {
      font-size: 16px;
      color: var(--color-text-secondary);
      margin: 0;
    }
    .form-group {
      margin-bottom: 24px;
    }
    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: var(--color-text);
      margin-bottom: 8px;
    }
    .form-group input {
      width: 100%;
      padding: 14px 16px;
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border);
      background: var(--color-bg);
      font-size: 15px;
      font-family: inherit;
      outline: none;
      color: var(--color-text);
      transition: all 0.15s ease;
      box-sizing: border-box;
    }
    .form-group input:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }
    .form-group input::placeholder {
      color: var(--color-text-muted);
    }
    .btn-primary {
      width: 100%;
      padding: 14px 24px;
      background: var(--color-primary);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-size: 16px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.15s ease;
      margin-bottom: 16px;
    }
    .btn-primary:hover {
      background: var(--color-primary-hover);
      transform: translateY(-2px);
      box-shadow: var(--shadow-primary);
    }
    .btn-primary:active {
      transform: translateY(0);
    }
    .btn-secondary {
      width: 100%;
      padding: 14px 24px;
      background: transparent;
      color: var(--color-primary);
      border: 2px solid var(--color-primary);
      border-radius: var(--radius-md);
      font-size: 16px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.15s ease;
      text-decoration: none;
      display: block;
      text-align: center;
      box-sizing: border-box;
    }
    .btn-secondary:hover {
      background: rgba(99, 102, 241, 0.05);
      transform: translateY(-2px);
    }
    .divider {
      display: flex;
      align-items: center;
      margin: 32px 0;
      color: var(--color-text-muted);
      font-size: 14px;
    }
    .divider::before,
    .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--color-border);
    }
    .divider span {
      padding: 0 16px;
    }
    .toggle-mode {
      text-align: center;
      margin-top: 24px;
      font-size: 14px;
      color: var(--color-text-secondary);
    }
    .toggle-mode a {
      color: var(--color-primary);
      font-weight: 600;
      text-decoration: none;
      margin-left: 4px;
    }
    .toggle-mode a:hover {
      text-decoration: underline;
    }
    .forgot-password {
      text-align: center;
      margin-top: 16px;
    }
    .forgot-password a {
      color: var(--color-primary);
      font-size: 14px;
      text-decoration: none;
      font-weight: 500;
    }
    .forgot-password a:hover {
      text-decoration: underline;
    }
    .error-message {
      background: rgba(239, 68, 68, 0.1);
      color: #dc2626;
      padding: 12px 16px;
      border-radius: var(--radius-md);
      font-size: 14px;
      margin-bottom: 24px;
      display: none;
    }
    .error-message.show {
      display: block;
    }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="logo">
      <a href="../index.html" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 8px;">
        <svg class="logo-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="url(#logoGradient1)"/>
          <path d="M2 17L12 22L22 17V12L12 17L2 12V17Z" fill="url(#logoGradient2)"/>
          <defs>
            <linearGradient id="logoGradient1" x1="2" y1="7" x2="22" y2="7" gradientUnits="userSpaceOnUse">
              <stop offset="0%" stop-color="#667eea"/>
              <stop offset="100%" stop-color="#764ba2"/>
            </linearGradient>
            <linearGradient id="logoGradient2" x1="2" y1="14.5" x2="22" y2="14.5" gradientUnits="userSpaceOnUse">
              <stop offset="0%" stop-color="#764ba2"/>
              <stop offset="100%" stop-color="#667eea"/>
            </linearGradient>
          </defs>
        </svg>
        <span>OptimizeAI</span>
      </a>
    </div>
    <nav class="nav-links">
      <a href="../index.html">Home</a>
      <a href="features.html">Features</a>
      <a href="how-it-works.html">How It Works</a>
    </nav>
  </header>

  <main>
    <div class="login-container">
      <div class="login-box">
        <div class="login-header">
          <h1 id="pageTitle">Sign In</h1>
          <p id="pageSubtitle">Welcome back! Sign in to continue optimizing your assignments.</p>
        </div>

        <div class="error-message" id="errorMessage"></div>

        <form id="authForm">
          <div id="nameField" class="form-group" style="display: none;">
            <label for="name">Full Name</label>
            <input type="text" id="name" name="name" placeholder="Enter your full name" required>
          </div>

          <div class="form-group">
            <label for="email">Email Address</label>
            <input type="email" id="email" name="email" placeholder="you@example.com" required>
          </div>

          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" placeholder="Enter your password" required>
          </div>

          <div id="confirmPasswordField" class="form-group" style="display: none;">
            <label for="confirmPassword">Confirm Password</label>
            <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm your password">
          </div>

          <button type="submit" class="btn-primary" id="submitBtn">Sign In</button>
        </form>

        <div class="forgot-password" id="forgotPasswordLink" style="display: block;">
          <a href="#">Forgot password?</a>
        </div>

        <div class="divider">
          <span>or</span>
        </div>

        <button type="button" class="btn-secondary" id="toggleBtn">Create New Account</button>

        <div class="toggle-mode">
          <span id="toggleText">Don't have an account?</span>
          <a href="#" id="toggleLink">Sign up</a>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      <div class="footer-col">
        <h4>Support</h4>
        <ul>
          <li class="support-contact">
            <span class="support-label">Having issues?</span>
            <a href="contact.html" class="support-email">optimizeaiapp@gmail.com</a>
          </li>
        </ul>
      </div>
      <div class="footer-col">
        <h4>Legal</h4>
        <ul>
          <li><a href="terms-of-service.html">Terms of Service</a></li>
          <li><a href="privacy-policy.html">Privacy Policy</a></li>
          <li><a href="academic-integrity.html">Academic Integrity</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <span>© <span id="year"></span> OptimizeAI. All rights reserved.</span>
    </div>
  </footer>

  <!-- Supabase Client Library -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../supabase-config.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('year').textContent = new Date().getFullYear();

      let isSignUp = false;
      let isLoading = false;

      function toggleMode() {
        isSignUp = !isSignUp;
        const nameField = document.getElementById('nameField');
        const confirmPasswordField = document.getElementById('confirmPasswordField');
        const forgotPasswordLink = document.getElementById('forgotPasswordLink');
        const pageTitle = document.getElementById('pageTitle');
        const pageSubtitle = document.getElementById('pageSubtitle');
        const submitBtn = document.getElementById('submitBtn');
        const toggleText = document.getElementById('toggleText');
        const toggleLink = document.getElementById('toggleLink');
        const form = document.getElementById('authForm');
        const confirmPasswordInput = document.getElementById('confirmPassword');

        if (isSignUp) {
          nameField.style.display = 'block';
          confirmPasswordField.style.display = 'block';
          forgotPasswordLink.style.display = 'none';
          pageTitle.textContent = 'Create Account';
          pageSubtitle.textContent = 'Join OptimizeAI and start improving your grades today.';
          submitBtn.textContent = 'Sign Up';
          toggleText.textContent = 'Already have an account?';
          toggleLink.textContent = 'Sign in';
          confirmPasswordInput.required = true;
        } else {
          nameField.style.display = 'none';
          confirmPasswordField.style.display = 'none';
          forgotPasswordLink.style.display = 'block';
          pageTitle.textContent = 'Sign In';
          pageSubtitle.textContent = 'Welcome back! Sign in to continue optimizing your assignments.';
          submitBtn.textContent = 'Sign In';
          toggleText.textContent = "Don't have an account?";
          toggleLink.textContent = 'Sign up';
          confirmPasswordInput.required = false;
        }
      }

      const toggleBtn = document.getElementById('toggleBtn');
      const toggleLink = document.getElementById('toggleLink');
      const authForm = document.getElementById('authForm');

      if (toggleBtn) {
        toggleBtn.addEventListener('click', toggleMode);
      }

      if (toggleLink) {
        toggleLink.addEventListener('click', (e) => {
          e.preventDefault();
          toggleMode();
        });
      }

      if (authForm) {
        authForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          if (isLoading) return; // Prevent multiple submissions
          
          const errorMessage = document.getElementById('errorMessage');
          const submitBtn = document.getElementById('submitBtn');
          
          // Validate required fields
          const email = document.getElementById('email').value.trim();
          const password = document.getElementById('password').value.trim();
          
          if (!email || !password) {
            errorMessage.textContent = 'Please fill in all required fields.';
            errorMessage.classList.add('show');
            return;
          }

          if (isSignUp) {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const name = document.getElementById('name').value.trim();
            
            if (password !== confirmPassword) {
              errorMessage.textContent = 'Passwords do not match.';
              errorMessage.classList.add('show');
              return;
            }
            
            if (!name) {
              errorMessage.textContent = 'Please enter your full name.';
              errorMessage.classList.add('show');
              return;
            }
            
            // Validate password strength
            if (password.length < 6) {
              errorMessage.textContent = 'Password must be at least 6 characters long.';
              errorMessage.classList.add('show');
              return;
            }
            
            // Sign up with Supabase
            isLoading = true;
            submitBtn.textContent = 'Creating Account...';
            submitBtn.disabled = true;
            errorMessage.classList.remove('show');
            
            try {
              const { data, error } = await supabaseClient.auth.signUp({
                email: email,
                password: password,
                options: {
                  data: {
                    full_name: name
                  }
                }
              });
              
              if (error) {
                throw error;
              }
              
              // Check if email confirmation is required
              if (data.user && !data.session) {
                errorMessage.textContent = 'Please check your email to confirm your account before signing in.';
                errorMessage.classList.add('show');
                submitBtn.textContent = 'Sign Up';
                submitBtn.disabled = false;
                isLoading = false;
                return;
              }
              
              // Store session
              if (data.session) {
                localStorage.setItem('supabase_session', JSON.stringify(data.session));
                localStorage.setItem('userLoggedIn', 'true');
                localStorage.setItem('userEmail', email);
                localStorage.setItem('userName', name);
                
                // Redirect to tool page
                window.location.href = '../tool.html';
              }
            } catch (error) {
              // Check if account already exists
              const errorMsg = error.message || '';
              if (errorMsg.toLowerCase().includes('already registered') || 
                  errorMsg.toLowerCase().includes('user already exists') ||
                  errorMsg.toLowerCase().includes('email already registered') ||
                  errorMsg.toLowerCase().includes('already exists')) {
                errorMessage.textContent = 'Your account already exists. Please sign in.';
              } else {
                errorMessage.textContent = errorMsg || 'An error occurred during sign up. Please try again.';
              }
              errorMessage.classList.add('show');
              submitBtn.textContent = 'Sign Up';
              submitBtn.disabled = false;
              isLoading = false;
            }
          } else {
            // Sign in with Supabase
            isLoading = true;
            submitBtn.textContent = 'Signing In...';
            submitBtn.disabled = true;
            errorMessage.classList.remove('show');
            
            try {
              const { data, error } = await supabaseClient.auth.signInWithPassword({
                email: email,
                password: password
              });
              
              if (error) {
                throw error;
              }
              
              // Store session
              if (data.session) {
                localStorage.setItem('supabase_session', JSON.stringify(data.session));
                localStorage.setItem('userLoggedIn', 'true');
                localStorage.setItem('userEmail', data.user.email);
                
                // Get user metadata (full name)
                const fullName = data.user.user_metadata?.full_name || email.split('@')[0];
                localStorage.setItem('userName', fullName);
                
                // Redirect to tool page
                window.location.href = '../tool.html';
              }
            } catch (error) {
              errorMessage.textContent = error.message || 'Invalid email or password. Please try again.';
              errorMessage.classList.add('show');
              submitBtn.textContent = 'Sign In';
              submitBtn.disabled = false;
              isLoading = false;
            }
          }
        });
      }
    });
  </script>
</body>
</html>

